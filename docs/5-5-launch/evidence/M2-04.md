# M2-04 Evidence

## Change Summary

- Completed hybrid retrieval implementation in memory service:
  - lexical + dense + graph + rerank blended scoring,
  - configurable per-query weighting controls,
  - query-term coverage boost for intent completeness,
  - corrected hybrid tokenizer whitespace parsing.
- Added precision gate test for deep retrieval (`precision@8 >= 0.88`) on a seeded evaluation set.

## Files Changed

- apps/desktop/src-sidecar/src/memory/memory-service.ts
- apps/desktop/src-sidecar/src/memory/memory-service.hybrid.test.ts

## Verification Commands

```bash
pnpm --filter @cowork/sidecar test -- src/memory/memory-service.hybrid.test.ts
pnpm --filter @cowork/sidecar test -- src/memory/memory-orchestrator.test.ts src/memory/consolidation-service.test.ts src/memory/semantic-memory-extractor.test.ts
pnpm --filter @cowork/sidecar typecheck
```

## Verification Output Summary

- Hybrid precision gate test passes (`precision@8` assertion >= `0.88`).
- Related memory test slice passes (`10/10` tests).
- Sidecar typecheck passes.

## Acceptance Mapping

- Plan acceptance criteria: Implement lexical + dense + graph fusion scoring and rerank pipeline.
- Result: Completed. Pipeline implemented and quality-gated with passing precision@8 test.

## Residual Risks

- Graph signal remains heuristic-based and should be upgraded to deeper graph traversal in later hardening.

## Rollback Path

- Revert hybrid scoring changes in memory service and remove hybrid precision gate test.
