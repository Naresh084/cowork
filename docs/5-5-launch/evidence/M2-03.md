# M2-03 Evidence

## Change Summary

- Replaced file-index-primary memory service internals with DB-backed adapter.
- Preserved existing MemoryService method surface for compatibility.
- Added one-time legacy import from `.cowork/memories/index.json` and `GEMINI.md` into DB-backed atoms.
- Added deep query/feedback methods with query/feedback persistence.

## Files Changed

- apps/desktop/src-sidecar/src/memory/memory-service.ts
- apps/desktop/src-sidecar/src/ipc-handler.ts
- apps/desktop/src-sidecar/src/agent-runner.ts

## Verification Commands

```bash
pnpm --filter @cowork/sidecar typecheck
pnpm --filter @cowork/desktop typecheck
```

## Verification Output Summary

- Sidecar and desktop typecheck pass with DB-backed memory service and IPC compatibility.

## Acceptance Mapping

- Plan acceptance criteria: Refactor memory service to DB-backed adapter while preserving compatibility.
- Result: Completed for sidecar runtime and IPC handlers.

## Residual Risks

- Retrieval scoring is still baseline and does not yet satisfy final hybrid+rereank target.

## Rollback Path

- Revert `memory-service.ts` and restore previous file-index implementation.
