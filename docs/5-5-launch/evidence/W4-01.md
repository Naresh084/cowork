# W4-01 Evidence

## Change Summary

- Implemented deterministic workflow resume checkpoints in:
  - `/Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/workflow/engine.ts`
- Added per-node runtime checkpoint persistence (`__runtime.checkpoint`) with:
  - completed node id,
  - next node id,
  - step index,
  - node run id,
  - recorded timestamp.
- Added deterministic resume behavior that advances from checkpointed node to next node and emits `run_resumed` with reason `deterministic_resume_checkpoint`.
- Added checkpoint update ordering to prevent duplicate side-effect execution after pause/cancel/restart windows.
- Added retry-time compensation hook support (configurable via node `config.compensation`) before retry attempts.
- Added coverage for resume dedupe and compensation behavior:
  - `/Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/workflow/engine.resume.test.ts`

## Files Changed

- /Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/workflow/engine.ts
- /Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/workflow/engine.resume.test.ts

## Verification Commands

```bash
pnpm --filter @cowork/sidecar test -- src/workflow/engine.resume.test.ts
pnpm --filter @cowork/sidecar typecheck
```

## Verification Output Summary

- Workflow engine resume suite passes (`2/2`).
- Sidecar typecheck passes.

## Acceptance Mapping

- Plan acceptance criteria: resume without duplicate side effects.
- Result: met by deterministic checkpoint-based resume pointer and explicit dedupe test.

## Residual Risks

- End-to-end workflow UI resume/cancel flow tests are still pending under workflow E2E tasks.

## Rollback Path

- Revert runtime checkpoint merge logic and compensation hook handling in `workflow/engine.ts`.
- Remove `engine.resume.test.ts` coverage if feature is rolled back.
