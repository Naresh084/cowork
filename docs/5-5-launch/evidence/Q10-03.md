# Q10-03 Evidence

## Change Summary

- Added core agent integration tests in `packages/core` covering:
  - multi-iteration tool loop with flaky tool retry pattern,
  - permission deny flow (tool skipped and denied result emitted),
  - resume error path when no pending tool call exists.
- Added sidecar reliability guardrail tests that support loop stability goals:
  - IPC idempotency dedupe behavior for retried commands,
  - release-gate assertion behavior.

## Files Changed

- packages/core/src/agent.integration.test.ts
- apps/desktop/src-sidecar/src/ipc-handler.idempotency.test.ts
- apps/desktop/src-sidecar/src/agent-runner.release-gate.test.ts

## Verification Commands

```bash
pnpm --filter @cowork/core test -- src/agent.integration.test.ts
pnpm --filter @cowork/core typecheck
pnpm --filter @cowork/sidecar test -- src/ipc-handler.idempotency.test.ts src/agent-runner.release-gate.test.ts
pnpm --filter @cowork/sidecar typecheck
```

## Verification Output Summary

- Core integration suite passes (`3/3`).
- Sidecar targeted reliability suites pass (`5/5`).
- Core and sidecar typechecks pass.

## Acceptance Mapping

- Plan acceptance criteria: add full-loop integration tests for tool/permission/retry/resume behavior.
- Result: Implemented with targeted integration coverage for retry-like loop progression, permission gating, and resume-path validation.

## Residual Risks

- Checkpoint persistence/restart-resume UX remains primarily covered by sidecar/desktop tests, not core package tests.

## Rollback Path

- Remove newly added integration/reliability test files.
