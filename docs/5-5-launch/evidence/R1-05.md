# R1-05 Evidence

## Change Summary

- Replaced ad-hoc substring-only provider error handling with structured taxonomy classification in Gemini provider:
  - authentication,
  - rate-limit,
  - quota,
  - model-not-found,
  - network-timeout,
  - network-error,
  - service-unavailable,
  - bad-request,
  - unknown.
- Added extracted retry metadata (`retryAfterMs`, `retryable`) and reason codes in error context.
- Added status/code extraction from structured error payloads and response headers.
- Mapped taxonomy to typed errors (`AuthenticationError`, `NetworkError`, `ProviderError`) with consistent status behavior.
- Added fixture-based taxonomy test suite with explicit accuracy gate (`>= 98%`).

## Files Changed

- packages/providers/src/gemini/gemini-provider.ts
- apps/desktop/src-sidecar/src/providers/gemini-provider.taxonomy.test.ts

## Verification Commands

```bash
pnpm --filter @gemini-cowork/sidecar test -- src/providers/gemini-provider.taxonomy.test.ts
pnpm --filter @gemini-cowork/providers typecheck
pnpm --filter @gemini-cowork/sidecar typecheck
```

## Verification Output Summary

- Taxonomy fixture tests pass (`3/3`) including accuracy assertion (`>= 0.98`).
- Providers and sidecar typecheck pass with new taxonomy flow.

## Acceptance Mapping

- Plan acceptance criteria: Replace provider substring parsing with structured taxonomy and retry hints; error class accuracy >= 98%.
- Result: Completed. Structured taxonomy is implemented and fixture gate is passing.

## Residual Risks

- Additional live-provider payload variants should continue to be added to fixture corpus as APIs evolve.

## Rollback Path

- Revert taxonomy classifier in Gemini provider and remove taxonomy fixture tests.
