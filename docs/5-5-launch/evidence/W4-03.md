# W4-03 Evidence

## Change Summary

- Replaced schedule-only trigger router behavior with adaptive chat-trigger scoring model in:
  - `/Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/workflow/trigger-router.ts`
- Added confidence-scored trigger evaluation using:
  - exact phrase match,
  - substring match,
  - token/message coverage,
  - strict-match gating,
  - specificity-adjusted activation threshold,
  - explainability reason codes + breakdown object.
- Added workflow service evaluation surface:
  - `/Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/workflow/service.ts`
  - new method `evaluateChatTriggers(...)` returning trigger matches with workflow name and diagnostics.
- Added sidecar IPC command for trigger diagnostics and optional autorun:
  - `/Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/ipc-handler.ts`
  - command: `workflow_evaluate_triggers`.
- Added unit coverage for strict/exact/partial ranking behavior:
  - `/Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/workflow/trigger-router.test.ts`
- Added seeded trigger-quality gate coverage:
  - `/Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/workflow/trigger-router.quality.test.ts`

## Files Changed

- /Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/workflow/trigger-router.ts
- /Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/workflow/service.ts
- /Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/ipc-handler.ts
- /Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/workflow/trigger-router.test.ts
- /Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/workflow/trigger-router.quality.test.ts

## Verification Commands

```bash
pnpm --filter @cowork/sidecar test -- src/workflow/trigger-router.test.ts
pnpm --filter @cowork/sidecar test -- src/workflow/trigger-router.quality.test.ts
pnpm --filter @cowork/sidecar typecheck
pnpm --filter @cowork/desktop typecheck
```

## Verification Output Summary

- Trigger router behavior suite passes (`3/3`).
- Trigger quality gate suite passes (`1/1`) with false-positive rate < 3% on seeded corpus.
- Sidecar and desktop typecheck pass.

## Acceptance Mapping

- Plan acceptance criteria: adaptive trigger confidence model with explainability output.
- Result: implemented and validated by unit tests.

## Rollback Path

- Revert adaptive scoring in `trigger-router.ts` and remove `workflow_evaluate_triggers` IPC handler.
