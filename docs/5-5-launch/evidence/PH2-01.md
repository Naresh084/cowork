# PH2-01 Evidence

## Change Summary

- Hardened run-v2 checkpoint path to persist replay payloads at `before_send` while keeping public checkpoint/timeline events sanitized.
- Implemented real resume execution path: `resumeRunFromCheckpoint` now reloads latest checkpoint, resolves replay payload, re-dispatches execution, and records resumed completion/failure checkpoints.
- Added safe terminal handling (`resume_noop`) for already completed/cancelled runs.
- Added fallback replay source from latest user message text when legacy checkpoints do not include dispatch payload.

## Files Changed

- /Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/agent-runner.ts
- /Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/agent-runner.run-resume.test.ts

## Verification Commands

```bash
pnpm --filter @cowork/sidecar test -- src/agent-runner.run-resume.test.ts
pnpm --filter @cowork/sidecar typecheck
```

## Verification Output Summary

- `agent-runner.run-resume.test.ts`: 3/3 tests passing.
- Sidecar TypeScript compile passes with no type errors.

## Acceptance Mapping

- Plan acceptance criteria: Implement checkpoint persistence and resume command path.
- Result: met. Resume command now performs checkpoint-backed replay execution instead of status-only recovery.

## Residual Risks

- Legacy runs with attachment-only prompts and no stored dispatch payload still degrade to text-only fallback replay.
- Full process-crash replay coverage remains tracked under reliability E2E expansion.

## Rollback Path

- Revert resume replay path in `agent-runner.ts` and restore prior status-only `resumeRunFromCheckpoint` behavior.
