# B3-06 Evidence

## Change Summary

- Completed branch cache + active-branch switch path:
  - session store caches `branchesBySession` and `activeBranchBySession`,
  - added `setActiveBranch` action with optimistic update + rollback,
  - added backend command path (`agent_set_active_branch` -> `session_branch_set_active`).
- Added in-chat "Use" control to switch active branch.
- Added E2E latency assertion for cached branch switch (<300ms).

## Files Changed

- /Users/naresh/Work/Personal/cowork/apps/desktop/src/stores/session-store.ts
- /Users/naresh/Work/Personal/cowork/apps/desktop/src/components/chat/BranchGraphPanel.tsx
- /Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/agent-runner.ts
- /Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/ipc-handler.ts
- /Users/naresh/Work/Personal/cowork/apps/desktop/src-sidecar/src/types.ts
- /Users/naresh/Work/Personal/cowork/apps/desktop/src-tauri/src/commands/agent.rs
- /Users/naresh/Work/Personal/cowork/apps/desktop/src-tauri/src/main.rs
- /Users/naresh/Work/Personal/cowork/apps/desktop/e2e/branching.spec.ts

## Verification Commands

```bash
pnpm --filter @cowork/desktop typecheck
pnpm --filter @cowork/sidecar typecheck
cd /Users/naresh/Work/Personal/cowork/apps/desktop/src-tauri && cargo check
pnpm playwright test e2e/branching.spec.ts --project=chromium --config playwright.reliability.local.config.ts
```

## Verification Output Summary

- Desktop, sidecar, and Rust compile checks pass.
- Branching E2E passes (`3/3`), including cached switch latency assertion.

## Acceptance Mapping

- Plan acceptance criteria: branch switch <300ms for cached states.
- Result: met.

## Residual Risks

- Multi-platform E2E replay matrix still needs CI expansion.

## Rollback Path

- Revert active-branch switch command and session-store switch action.
