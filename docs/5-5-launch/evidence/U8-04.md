# U8-04 Evidence

## Change Summary

- Extended unified turn activities to include memory lifecycle events in the same timeline surface as stream/tool/permission/question/assistant events.
- Added memory event ingestion in event hook for:
  - `memory:retrieved`
  - `memory:consolidated`
  - `memory:conflict_detected`
- Persisted memory events into chat timeline as `system_message` items with memory metadata.
- Updated activity derivation to map memory metadata into `TurnActivityItem` entries (`type: "memory"`).
- Added inline memory activity row rendering in message timeline with compact summary/detail labels.

## Files Changed

- apps/desktop/src/hooks/useAgentEvents.ts
- apps/desktop/src/stores/chat-store.ts
- apps/desktop/src/components/chat/MessageList.tsx
- apps/desktop/src/stores/chat-store.test.ts

## Verification Commands

```bash
pnpm --filter @gemini-cowork/desktop typecheck
pnpm --filter @gemini-cowork/sidecar typecheck
cd apps/desktop && pnpm vitest --run src/stores/chat-store.test.ts
```

## Verification Output Summary

- Desktop and sidecar typechecks pass.
- `chat-store` test suite passes, including new memory-activity derivation coverage.

## Acceptance Mapping

- Plan acceptance criteria: Timeline readable under heavy runs with unified grouping across stream/tool/permission/memory events.
- Result: Done. Memory events are now grouped in the same turn activity timeline as existing stream/tool/permission flow.

## Residual Risks

- Memory events currently render as summarized activity cards; deep drilldown details (full payload inspector) remain future UX polish.

## Rollback Path

- Revert memory event-to-chat-item mapping in `useAgentEvents.ts`.
- Revert memory activity derivation in `chat-store.ts`.
- Revert memory activity row in `MessageList.tsx`.
